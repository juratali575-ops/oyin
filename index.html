<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beige Chess O'zbekcha</title>
<style>
body { margin:0; font-family:Arial; background:#f5f0e6; text-align:center; color:#000; }
header { background:#000; padding:12px; }
header a { color:#f5f0e6; text-decoration:none; font-weight:bold; font-size:18px; }
.menu { margin-top:40px; }
button { padding:12px 25px; margin:12px; background:#000; color:#f5f0e6; border:none; border-radius:5px; cursor:pointer; font-size:16px; transition:0.2s; }
button:hover { background:#333; transform:scale(1.05); }
.room-code { font-weight:bold; margin-top:10px; color:#333; }
#boardContainer { margin-top:30px; display:none; }
#board { display:grid; grid-template-columns:repeat(8,60px); grid-template-rows:repeat(8,60px); width:480px; height:480px; margin:0 auto; border:2px solid #000; }
.square { width:60px; height:60px; display:flex; align-items:center; justify-content:center; font-size:36px; cursor:pointer; transition:background 0.3s; }
.white { background:#f5f0e6; }
.black { background:#000; color:#f5f0e6; }
.square.selected { outline:3px solid red; }
.square.legal-move { outline:3px solid #ffcc00; }
#infoBox { display:none; max-width:500px; margin:20px auto; padding:15px; background:#fff; border-radius:8px; border:1px solid #000; text-align:left; }
footer { margin:20px 0; }
</style>
</head>
<body>

<header>
<a href="https://t.me/+998946612013" target="_blank">Telegram: +998 94 661 20 13</a>
</header>

<main>

<!-- 1. Til tanlash -->
<div id="languageMenu" class="menu">
<h1>Tilni tanlang</h1>
<button onclick="chooseLanguage('uz')">O'zbekcha</button>
<button onclick="chooseLanguage('en')">English</button>
<button onclick="chooseLanguage('ru')">Русский</button>
</div>

<!-- 2. O'yin turi -->
<div id="modeMenu" class="menu" style="display:none;">
<h1 id="modeTitle">O'yin turini tanlang</h1>
<button onclick="selectMode('local')" id="btnLocal">2 O'yinchi (Bitta qurilmada)</button>
<button onclick="selectMode('ai')" id="btnAI">AI bilan o'ynash</button>
<button onclick="selectMode('multi')" id="btnMulti">Ko'p o'yinchi</button>
<p id="roomDisplay" class="room-code"></p>
</div>

<!-- 3. Shaxmat taxtasi -->
<div id="boardContainer">
<div id="board"></div>
</div>

<div id="infoBox">
<h3>Ma'lumot</h3>
<p>Beige Chess O'zbekcha: 2 o'yinchi, AI bilan yoki multiplayer rejimda o'ynash mumkin. Qoidalarga binoan harakatlar belgilangan, AI o'rtacha darajada. Telegram orqali yordam olish mumkin.</p>
</div>

<footer>
<button onclick="showInfo()">Ma'lumot</button>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chess.js@1.0.0-beta.1/dist/chess.min.js"></script>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
const boardEl = document.getElementById("board");
const languageMenu = document.getElementById("languageMenu");
const modeMenu = document.getElementById("modeMenu");
const boardContainer = document.getElementById("boardContainer");
let chess = new Chess();
let selectedSquare = null;
let mode = "local";
let currentPlayer = "white";
let socket = null;
let roomCode = "";
let language = "uz";

const pieces = { r:"♜", n:"♞", b:"♝", q:"♛", k:"♚", p:"♟",
                 R:"♖", N:"♘", B:"♗", Q:"♕", K:"♔", P:"♙" };

// --- Til tanlash ---
function chooseLanguage(lang){
    language = lang;
    languageMenu.style.display = "none";
    modeMenu.style.display = "block";
}

// --- O'yin turini tanlash ---
function selectMode(selected){
    mode = selected;
    modeMenu.style.display = "none";
    boardContainer.style.display = "block";
    chess.reset();
    currentPlayer = "white";
    createBoard();
    if(mode==="ai" && currentPlayer==="black") setTimeout(aiMove,200);
    if(mode==="multi") initMultiplayer();
}

// --- Shaxmat taxtasini yaratish ---
function createBoard(){
    boardEl.innerHTML = "";
    const boardArray = chess.board();
    for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
            const sq = document.createElement("div");
            sq.className = "square " + ((r+c)%2===0?"white":"black");
            sq.dataset.row=r;
            sq.dataset.col=c;
            const piece = boardArray[r][c];
            if(piece) sq.textContent = pieces[piece.color==="w"?piece.type.toUpperCase():piece.type];
            sq.addEventListener("click", ()=>selectSquareFunc(sq));
            boardEl.appendChild(sq);
        }
    }
}

// --- Harakatni boshqarish ---
function highlightLegalMoves(square){
    document.querySelectorAll(".square").forEach(s=>s.classList.remove("legal-move"));
    const row = parseInt(square.dataset.row);
    const col = parseInt(square.dataset.col);
    const piece = chess.board()[row][col];
    if(!piece || piece.color !== (currentPlayer==="white"?"w":"b")) return;
    const moves = chess.moves({square: coordsToSquare(row,col), verbose:true});
    moves.forEach(m=>{
        const [r,c] = squareToCoords(m.to);
        const sqEl = document.querySelector(`.square[data-row='${r}'][data-col='${c}']`);
        sqEl.classList.add("legal-move");
    });
}

function coordsToSquare(r,c){ const files="abcdefgh"; return files[c] + (8-r); }
function squareToCoords(square){ const files="abcdefgh"; return [8-parseInt(square[1]), files.indexOf(square[0])]; }

function selectSquareFunc(sq){
    if(selectedSquare){
        const from = coordsToSquare(parseInt(selectedSquare.dataset.row),parseInt(selectedSquare.dataset.col));
        const to = coordsToSquare(parseInt(sq.dataset.row),parseInt(sq.dataset.col));
        const move = chess.move({from,to,promotion:"q"});
        if(move){
            selectedSquare=null;
            currentPlayer = currentPlayer==="white"?"black":"white";
            createBoard();
            if(mode==="ai" && currentPlayer==="black") setTimeout(aiMove,200);
            if(mode==="multi" && socket) socket.emit("move",{from,to});
        } else selectedSquare=null;
        document.querySelectorAll(".square").forEach(s=>s.classList.remove("selected","legal-move"));
    } else {
        selectedSquare = sq;
        sq.classList.add("selected");
        highlightLegalMoves(sq);
    }
}

// --- AI harakati ---
function aiMove(){
    const moves = chess.moves();
    const move = moves[Math.floor(Math.random()*moves.length)]; // o'rtacha AI
    chess.move(move);
    currentPlayer="white";
    createBoard();
}

// --- Multiplayer ---
function initMultiplayer(){
    roomCode = generateRoomCode();
    document.getElementById("roomDisplay").innerText = "Room kodi: "+roomCode;
    socket = io("https://shaxmat.uz"); // server URL o'zgartiring
    socket.emit("join",roomCode);
    socket.on("move",data=>{
        chess.move({from:data.from,to:data.to,promotion:"q"});
        currentPlayer = currentPlayer==="white"?"black":"white";
        createBoard();
    });
}

function generateRoomCode(){ const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"; let code=""; for(let i=0;i<6;i++){ code+=chars[Math.floor(Math.random()*chars.length)]; } return code; }

// --- Info ---
function showInfo(){ document.getElementById("infoBox").style.display="block"; }
</script>

</body>
</html>
